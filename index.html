<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.js'></script>
    <script type="text/javascript" src="simcir.js"></script>
    <link rel="stylesheet" type="text/css" href="simcir.css" />
    <script type="text/javascript" src="simcir-basicset.js"></script>
    <link rel="stylesheet" type="text/css" href="simcir-basicset.css" />
    <script type="text/javascript" src="simcir-library.js"></script>
    <!-- semantic-ui -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <title></title>
  </head>
  <body>

    <!-- ローディング画面 -->
    <div class="ui active dimmer" id="load-dimmer">
      <div class="ui massive text loader">
        <h3>Loading</h3>
      </div>
    </div>

    <!-- サイドバーメニュー -->
    <div class="ui left sidebar inverted vertical menu" id="side-menu">
      <div class="item" style="text-align: center;">
         <h2 class="ui icon header">
            <i class="ic-white tasks icon"></i>
            <div class="ic-white content">
                tasks
            </div>
        </h2>
      </div>
      <a class="item">
        <i class="tag icon"></i>
        <div class="content">
          <div class="huge header"></div>
          <div class="description"></div>
        </div>
      </a>
      <a class="item">
        <i class="tag icon"></i>
        <div class="content">
          <div class="huge header"></div>
          <div class="description"></div>
        </div>
      </a>
      <a class="item">
        <i class="tag icon"></i>
        <div class="content">
          <div class="huge header"></div>
          <div class="description"></div>
        </div>
      </a>
    </div>

    <!-- 上部ナビゲーションメニュー -->
    <div class="ui fixed menu" id="top-menu">
      <div class="menu">
        <div id="js-sidebar" class="item">
          <i class="icon large grey content"></i>
        </div>
        <div class="item task-num">
        </div>
        <div class="item task-name">
        </div>
      </div>
      <a class="right item" href="https://nu-nishimori-lab.netlify.app/">新潟大学 西森研究室</a>
    </div>

    <!-- コンテンツ本体 -->
    <div id="main-container">

      <!-- 課題の内容 -->
      <div class="ui vertical segment" id="explain">
        <div class="paragraph">
          <div class="ui large header task-title"></div>
          <div class="content task-description"></div>
        </div>
      </div>


      <!-- 回路の構成のダウンロード/アップロード -->
      <div class="ui vertical segment">
        <button class="ui labeled icon button" id="dl-button" tabindex="0">
          <i class="download icon"></i>
          回路構成をダウンロード
        </button>
        <div class="ui input">
          <input type="file" id="ul-input">
          <label for="ul-input" class="ui labeled icon button">
            <i class="ui upload icon"></i>
            回路構成をセット
          </label>
      </div>

      <!-- 回路 -->
      <div class="ui vertical segment" id="simcir-container">
        <div class="simcir">
          {
            "width": 2000,
            "height": 2000
          }
        <!-- paste here your circuit data -->
        </div>
      </div>
    </div>
    
  </body>
</html>
<script>
// simcir.registerDevice('MyDevice',
// // paste here your circuit data
// );

innerWidth = $(window).innerWidth()
simcirWidth = (innerWidth < 1000 ? 1000 : innerWidth)

innerHeight = $(window).innerHeight()
simcirHeight = (innerHeight < 1500 ? 1500 : innerHeight)

function loadTextFiles(dirName) {
  $.when(
    $("#top-menu .task-num").load(`./${dirName}/task_num.html`),
    $("#top-menu .task-name").load(`./${dirName}/task_name.html`),
    $("#explain .task-title").load(`./${dirName}/task_title.html`),
    $("#explain .task-description").load(`./${dirName}/task_description.html`),
    $.get(`./${dirName}/initial_circuit.json`, function(data){
      console.log(data);
      simcir.setupSimcir($(".simcir"), JSON.parse(data));
    })
  ).done(function(){
    $("#load-dimmer").removeClass("active");
    $("#load-dimmer").addClass("disabled");
  })
};

$(function() {
  // 初期実行
  $("#simcir-container").height($(window).innerHeight() * 0.85);
  const dirList = ["practice", "task1", "task2"];
  for (let i = 0; i < dirList.length; i++) {
    $(`#side-menu a:nth-of-type(${i+1}) .header`).load(`./${dirList[i]}/task_num.html`);
    $(`#side-menu a:nth-of-type(${i+1}) .description`).load(`./${dirList[i]}/task_name.html`);
    $(`#side-menu a:nth-of-type(${i+1})`).attr("dirName", dirList[i]);

    $(`#side-menu a:nth-of-type(${i+1})`).on('click', function() {
      $("#load-dimmer").removeClass("disabled");
      $("#load-dimmer").addClass("active");
      dirName = $(this).attr("dirName");
      $('.ui.sidebar').sidebar('toggle');
      loadTextFiles(dirName);
    });
  }
  loadTextFiles("practice");

  // リサイズ時の処理
  $(window).resize(function() {
    $("#simcir-container").height($(window).innerHeight() * 0.85);
  });
  
  // メニューボタンクリック時の処理
  $('#js-sidebar').click(function() {
    $('.ui.sidebar').sidebar('toggle');
  });

  // ダウンロードボタンクリック時の処理
  $("#dl-button").on('click', function() {
    const text = simcir.controller($('.simcir').find(".simcir-workspace")).text();
    const link = document.createElement('a');
    link.href = window.URL.createObjectURL(new Blob([text]));
    link.download = "circuit.json";
    link.click();
  });

  // アップロードボタンクリック時の処理
  $("#ul-input").on("change", function(){
    if ($(this).val() !== '') {
      const fileObj = $(this).prop("files")[0];
      var reader_ = new FileReader();
      // ファイル読み込み成功時のイベント
      reader_.onload = function() {
          simcir.setupSimcir($(".simcir"), JSON.parse(reader_.result));
      }
      reader_.readAsText(fileObj);
    }
  })
});
</script>
<style>
#main-container {
    margin: 0 3% 2%;
    padding-top: 70px;
}

#main-container>#explain {
}

#simcir-container {
  overflow: scroll;
}

input[type=file] { 
	width: 0.1px;
	height: 0.1px;
	opacity: 0;
	overflow: hidden;
	position: absolute;
	z-index: -1;
}

.ic-white {
  color: rgb(230, 230, 230);
}
</style>